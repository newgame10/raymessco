<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ray Mess Co</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #CF9524; }
    .hidden { display: none; }
    /* Forzar color negro en placeholders */
    input::placeholder,
    textarea::placeholder {
      color: #000 !important;
      opacity: 1;
    }
  </style>
</head>
<body class="flex items-center justify-center h-screen">

  <!-- Splash -->
  <div id="splash" class="flex flex-col items-center justify-center h-full">
    <img src="icon-192.png" alt="Logo" class="w-32 h-32 animate-pulse">
    <h1 class="text-3xl font-bold text-[#CF9524] mt-4">Ray Mess Co</h1>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden flex-col w-full p-4">
    <h1 class="text-2xl font-bold flex items-center gap-2 text-[#CF9524]">
      <img src="icon-192.png" alt="Logo" class="w-8 h-8"> Ray Mess Co
    </h1>

    <!-- Botón -->
    <button onclick="openModal()"
      class="bg-[#CF9524] text-black px-4 py-2 rounded-lg mt-4 font-bold">
      ➕ Registrar servicio
    </button>

    <!-- Lista -->
    <div id="service-list" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center">
    <div class="bg-black border border-[#CF9524] p-6 rounded-xl w-96 text-[#CF9524]">
      <div class="flex justify-center">
        <img src="icon-192.png" alt="Logo" class="w-20 h-20 mb-2">
      </div>
      <h2 class="text-xl font-bold mb-4 text-center">Registra el servicio</h2>
      <form id="service-form" class="flex flex-col gap-3">
        <input name="cliente" placeholder="Nombre Del Cliente" class="p-2 bg-[#CF9524] text-black placeholder-black rounded" required>
        <input name="recoger" placeholder="Dirección De Recogida" class="p-2 bg-[#CF9524] text-black placeholder-black rounded" required>
        <input name="entregar" placeholder="Dirección De Entrega" class="p-2 bg-[#CF9524] text-black placeholder-black rounded" required>
        <input name="telefono" placeholder="Número De Teléfono" class="p-2 bg-[#CF9524] text-black placeholder-black rounded">
        <input name="volumen" placeholder="Volumen (cantidad/medidas)" class="p-2 bg-[#CF9524] text-black placeholder-black rounded">
        <input type="file" name="foto" accept="image/*" class="p-2 bg-[#CF9524] text-black rounded">
        <textarea name="observaciones" placeholder="Observaciones" class="p-2 bg-[#CF9524] text-black placeholder-black rounded"></textarea>
        <!-- Botón verde -->
        <button type="submit" class="bg-green-500 text-black font-bold py-2 rounded">Register</button>
      </form>
      <button onclick="closeModal()" class="mt-3 text-red-500">Cancelar</button>
    </div>
  </div>

  <script>
    // Splash
    setTimeout(() => {
      document.getElementById('splash').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
    }, 3000);

    // Modal
    let editIndex = null;
    function openModal(index=null){
      editIndex = index;
      const form = document.getElementById("service-form");
      form.reset();
      if(index !== null){
        const s = services[index];
        form.cliente.value = s.cliente;
        form.recoger.value = s.recoger;
        form.entregar.value = s.entregar;
        form.telefono.value = s.telefono;
        form.volumen.value = s.volumen;
        form.observaciones.value = s.observaciones;
      }
      document.getElementById('modal').classList.remove('hidden');
    }
    function closeModal(){ document.getElementById('modal').classList.add('hidden'); }

    // Servicios
    let services = JSON.parse(localStorage.getItem("services") || "[]");

    function saveServices(){ localStorage.setItem("services", JSON.stringify(services)); }

    function renderServices(){
      const list = document.getElementById("service-list");
      list.innerHTML = "";
      services.forEach((s, index) => {
        const card = document.createElement("div");
        card.className = "bg-[#CF9524] text-black p-4 rounded-xl shadow flex flex-col";
        card.innerHTML = `
          <p><b>Cliente:</b> ${s.cliente}</p>
          <p>📞 <b>Tel:</b> ${s.telefono ? `<a href="tel:${s.telefono}" class="underline">${s.telefono}</a>` : "-"}</p>
          <p>📍 <b>Recoger:</b> <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.recoger)}" target="_blank" class="underline">${s.recoger}</a></p>
          <p>📍 <b>Entregar:</b> <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.entregar)}" target="_blank" class="underline">${s.entregar}</a></p>
          <p><b>Volumen:</b> ${s.volumen || "-"}</p>
          <p><b>Observaciones:</b> ${s.observaciones || "-"}</p>
          ${s.foto ? `<img src="${s.foto}" alt="Foto del paquete" class="mt-2 rounded-lg">` : ""}
          <p class="font-bold mt-2">Estado: ${s.estado === "entregado" ? "🟢 Entregado" : "⏳ Pendiente"}</p>
          <div class="flex gap-2 mt-4">
            <button onclick="toggleEstado(${index})" class="flex-1 bg-black text-[#CF9524] px-3 py-1 rounded">Cambiar estado</button>
            <button onclick="openModal(${index})" class="flex-1 bg-blue-600 text-white px-3 py-1 rounded">✏️ Editar</button>
            <button onclick="deleteService(${index})" class="flex-1 bg-red-600 text-white px-3 py-1 rounded">🗑️ Eliminar</button>
          </div>
        `;
        list.appendChild(card);
      });
    }

    function toggleEstado(i){
      services[i].estado = services[i].estado === "entregado" ? "pendiente" : "entregado";
      saveServices(); renderServices();
    }

    function deleteService(i){
      if(confirm("¿Eliminar servicio?")){
        services.splice(i,1); saveServices(); renderServices();
      }
    }

    document.getElementById("service-form").addEventListener("submit", async e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));

      if(e.target.foto.files[0]){
        const file = e.target.foto.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          data.foto = reader.result;
          saveData();
        };
        reader.readAsDataURL(file);
      } else {
        saveData();
      }

      function saveData(){
        if(editIndex !== null){
          services[editIndex] = {...services[editIndex], ...data};
          editIndex = null;
        } else {
          services.push({...data, estado:"pendiente"});
        }
        saveServices(); renderServices(); closeModal(); e.target.reset();
      }
    });

    renderServices();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
</body>
</html>


